import{e as oe,z as Pe,Q as S,o as g,a as D,b as n,t as ae,U as ke,V as ye,P as d,u as H,s as qe,r as Je,X as x,f as r,w as M,af as xe,ag as Ge,a4 as Ke,A as Qe,y as he,j as Xe,ae as Ye,N as j,c as ee,W as N,k as Ze,ah as et,a5 as tt,Y as Se}from"./entry-2b318d32.mjs";import{_ as Ce}from"./plugin-vue_export-helper-84c1d017.mjs";import{b as at,c as ot,d as it,e as st,f as nt}from"./index-ec697f0e.mjs";import{u as lt}from"./useSeo-e7ac090c.mjs";const rt={class:"flex flex-col w-full px-5"},ct={class:"text-vanilla-yellow border-b-light-50 border-solid border-b-[2.5px]"},dt=["for"],ut=oe({__name:"RadioList",props:{title:null,items:null,modelValue:null,disabled:{type:Boolean}},emits:["update:modelValue"],setup(m,{emit:e}){const t=m,o=Pe({get(){return t.modelValue},set(a){e("update:modelValue",a)}});return(a,s)=>{const u=S("RadioButton");return g(),D("div",rt,[n("h3",ct,ae(m.title),1),(g(!0),D(ke,null,ye(m.items,(l,p)=>(g(),D("div",{class:"field-radiobutton m-2 mt-2",key:p+l.label},[d(u,{modelValue:H(o),"onUpdate:modelValue":s[0]||(s[0]=b=>qe(o)?o.value=b:null),id:l.label,name:m.title,value:l.label,disabled:m.disabled,class:"mx-2"},null,8,["modelValue","id","name","value","disabled"]),n("label",{for:l.label},ae(l.label),9,dt)]))),128))])}}}),ht={class:"flex flex-col h-screen w-full"},vt={class:"basis-[5rem] flex-grow-0 flex flex-row bg-dark-400 m-4 cool-shadow overflow-hidden"},ft={class:"flex-1 flex align-middle justify-start items-center pl-4"},mt={class:"flex-0 w-20 items-center flex justify-center"},pt={class:"flex-1 flex flex-col relative bg-dark-400 m-4 cool-shadow overflow-hidden"},gt={class:"absolute left-0 right-0 bottom-0 top-0"},bt=oe({__name:"Drawer",props:{title:null,open:{type:Boolean}},emits:["update:open"],setup(m,{emit:e}){const t=()=>{e("update:open",!1)};return(o,a)=>{const s=S("Button");return g(),D("div",{class:x(["flex-grow-0 w-md h-screen z-50 flex-col overflow-hidden transition-all duration-[400ms] text-light-50 box-content max-w-full <sxl:fixed <sxl:right-0 <sxl:top-0 <sxl:bottom-0",{"!w-0":!m.open}])},[n("div",ht,[n("div",vt,[n("div",ft,[n("h2",null,ae(m.title),1)]),n("div",mt,[d(s,{icon:"pi pi-times",class:"p-button-rounded p-button-text !text-light-50",onClick:t})])]),n("div",pt,[n("div",gt,[Je(o.$slots,"default",{},void 0,!0)])])])],2)}}});var _t=Ce(bt,[["__scopeId","data-v-3ea764bc"]]);const wt={ref:"chatContainer",class:"flex flex-1 h-full flex-col p-4 min-w-[300px]"},xt={ref:"chatInputContainer",class:"inline-flex flex-grow-0 w-full align-center pt-5"},St=oe({__name:"Chat",props:{modelValue:null},emits:["update:modelValue"],setup(m,{emit:e}){const t=m,o=r(""),a=r(null);function s(){o.value&&(e("update:modelValue",[...t.modelValue,{data:o.value.trim(),own:!0}]),o.value="")}function u(l){l.key==="Enter"&&s()}return M(()=>t.modelValue,l=>{a.value.scrollTop+a.value.offsetHeight==a.value.scrollHeight&&setTimeout(()=>{a.value.scrollTop=a.value.scrollHeight},20)},{deep:!0}),(l,p)=>{const b=S("InputText"),w=S("Button");return g(),D("div",wt,[n("div",{ref_key:"chatMessagesContainer",ref:a,class:"flex-1 w-full overflow-auto font-normal text-base break-words pb-4 flex flex-col"},[(g(!0),D(ke,null,ye(m.modelValue,(T,P)=>(g(),D("div",{class:x(["bg-dark-50 max-w-6/10 p-2 px-4 m-2 rounded-lg self-start",{"self-message":T.own}]),key:P},ae(T.data),3))),128))],512),n("div",xt,[d(b,{type:"text",class:"w-full",modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=T=>o.value=T),onKeydown:u},null,8,["modelValue"]),d(w,{icon:"pi pi-chevron-right",class:"p-button-rounded p-button-secondary p-button-text",onClick:s})],512)],512)}}});var kt=Ce(St,[["__scopeId","data-v-d8289092"]]);class yt{constructor(e){this._devices=[],this._currentStream=new MediaStream,this._currentScreenStream=new MediaStream,this.defaultConstraints={audio:{autoGainControl:!1,channelCount:1,echoCancellation:!0,latency:0,noiseSuppression:!0,sampleRate:48e3,sampleSize:16},video:{width:{min:640,max:1920},height:{min:400,max:1920},aspectRatio:{min:.2,ideal:16/9},frameRate:{min:10,ideal:60,max:240}}},this._videoLocal=e}get currentDevices(){const e=this.currentVideoTracks,t=this.currentAudioTracks;return this._currentStream?{audio:t[0]&&t[0].label,video:e[0]&&e[0].label}:null}get mediaDevices(){return this._devices}get audioDevices(){return this._devices.filter(e=>e.kind=="audioinput")}get videoDevices(){return this._devices.filter(e=>e.kind=="videoinput")}get currentStream(){return this._currentStream}get currentVideoTracks(){return this._currentStream.getVideoTracks()}get currentVideoCapabilities(){return this.currentStream.getVideoTracks()[0]?this.currentStream.getVideoTracks()[0].getCapabilities():null}get currentAudioTracks(){return this._currentStream.getAudioTracks()}async getMediaDevices(){return this._devices=await navigator.mediaDevices.enumerateDevices(),console.log(this._devices),this._devices}getMediaDeviceByName(e){return e?this._devices.find(t=>t.label==e):null}async getMediaDevicesStream(e=this.defaultConstraints,t=!0){if(navigator&&navigator.mediaDevices)try{if(await this.getMediaDevices(),this.audioDevices.length<=0&&(e.audio=!1),this.videoDevices.length<=0&&(e.video=!1),t){const o=this.getMediaSourcesInfoFromLocalStorage(),a=this.getMediaDeviceByName(o.audio),s=this.getMediaDeviceByName(o.video);a&&(typeof e.audio=="boolean"?e.audio={deviceId:a.deviceId}:(e.audio=e.audio,!e.audio.deviceId&&(e.audio.deviceId=a.deviceId))),s&&(typeof e.video=="boolean"?e.video={deviceId:s.deviceId}:(e.video=e.video,!e.video.deviceId&&(e.video.deviceId=s.deviceId)))}return console.log("constraints",e),this._currentStream=await navigator.mediaDevices.getUserMedia(e),console.log("current stream",this._currentStream.getVideoTracks()[0].getSettings()),this._currentStream}catch(o){return console.log(o),null}return null}async getScreenStream(){if(navigator&&navigator.mediaDevices)try{return this._currentScreenStream=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}),console.log(this._currentScreenStream),await this.stopAndRemoveVideo(),this.currentStream.addTrack(this._currentScreenStream.getVideoTracks()[0]),this._currentScreenStream}catch(e){return console.log(e),null}return null}async initializeLocalStream(e=this.defaultConstraints){const t=await this.getMediaDevicesStream(e);return t?(this.attachStreamToLocalVideo(t),t):null}async stopLocalStream(){this.currentStream.getTracks().forEach(e=>e.stop())}async changeSourceStream(e,t){this.currentDevices.audio!=e&&(await this.stopAndRemoveAudio(),await this.startAudio(e)),this.currentDevices.video!=t&&(await this.stopAndRemoveVideo(),await this.startVideo(t)),this.setMediaSourcesInfoFromLocalStorage(e,t)}attachStreamToLocalVideo(e){e&&(console.log(this._videoLocal),this._videoLocal&&e&&(this._videoLocal.value.srcObject=e),this._videoLocal.value.muted=!0,this._videoLocal.value.play())}async stopAndRemoveVideo(){this.currentVideoTracks.forEach(e=>e.enabled=!1),await new Promise(e=>setTimeout(e,100)),this.currentVideoTracks.forEach(e=>{e.stop(),this._currentStream.removeTrack(e)})}stopAndRemoveAudio(){this.currentAudioTracks.forEach(e=>{e.stop(),this._currentStream.removeTrack(e)})}stopAudio(){this.currentVideoTracks.forEach(e=>e.stop())}stopVideo(){this.currentAudioTracks.forEach(e=>e.stop())}async startVideo(e){const t=this.getMediaDeviceByName(e);let o=!1;t&&(o={...this.defaultConstraints.video,deviceId:t.deviceId}),console.log("videoConstraint startvideo",e,o);let a=await navigator.mediaDevices.getUserMedia({video:o});return this.currentVideoTracks[0]&&this.currentStream.removeTrack(this.currentVideoTracks[0]),this.currentStream.addTrack(a.getVideoTracks()[0]),a}async startAudio(e){const t=this.getMediaDeviceByName(e);let o=!1;t&&(o={...this.defaultConstraints.audio,deviceId:t.deviceId});let a=await navigator.mediaDevices.getUserMedia({audio:o});return this.currentAudioTracks[0]&&this.currentStream.removeTrack(this.currentAudioTracks[0]),this.currentStream.addTrack(a.getAudioTracks()[0]),a}getMediaSourcesInfoFromLocalStorage(){return JSON.parse(localStorage.getItem("mediaSources")||'{"audio":null,"video":null}')}setMediaSourcesInfoFromLocalStorage(e,t){let o=this.getMediaSourcesInfoFromLocalStorage(),a={};e&&(a.audio=e),t&&(a.video=t),localStorage.setItem("mediaSources",JSON.stringify({...o,...a}))}disableVideo(){this.currentVideoTracks.forEach(e=>e.enabled=!1)}enableVideo(){this.currentAudioTracks.forEach(e=>e.enabled=!0)}disableAudio(){this.currentAudioTracks.forEach(e=>e.enabled=!1)}enableAudio(){this.currentAudioTracks.forEach(e=>e.enabled=!0)}}class te{constructor(e,t,o,a,s){this._localCandidates=[],this._remoteCandidates=[],this._videoChatSendStream=new MediaStream,this._videoChatSenders={},this._receiveStreams={},this._dataChannels={},this._websocket=null,this._signalingFromWebsocket=!1,this._connected=!1,this._state="",this.websocket_configuration={address:"wss://skynet.sytes.net:5355/ws/"},this.configuration={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:skynet.sytes.net:5349",username:"guest",credential:"&!bYELZK$&X^n5Tm#bKu6bQe"}]},this.pc=new RTCPeerConnection(this.configuration),this._onTrack=t,this._onDataChannel=o,this._writeOnChat=a,this._writeOnOffer=s,this._mediaSourcesHandler=e,this.pc.onicecandidate=u=>{if(u.candidate)this._localCandidates.push(u.candidate);else{const l={sdp:this.pc.localDescription,candidate:this._localCandidates},p=xe.compressToEncodedURIComponent(JSON.stringify(l));this._signalingFromWebsocket&&this._websocket?this._websocket.send(p):(s?s(p):console.log(p),navigator.clipboard.writeText(p))}},this.pc.ontrack=u=>{console.log("got track",u),u.streams.forEach(l=>{l.id in this._receiveStreams||(this._receiveStreams[l.id]=l)}),console.log("got track settings",u.streams[0].getTracks()[0].getSettings()),this._onTrack&&this._onTrack(this,u.track,u.streams)},this.pc.ondatachannel=u=>{const l=u.channel;this._dataChannels[l.label]=l,l.label!=="p2p"?this._onDataChannel&&this._onDataChannel(this,this._dataChannels[l.label]):this.p2pDataChannelInitialization(l)},this.pc.oniceconnectionstatechange=u=>{console.log(this.pc.iceConnectionState)},this.pc.onnegotiationneeded=u=>{console.log("negotiation needed"),this.createOffer().then(l=>{this._dataChannels.p2p.send(JSON.stringify({sdp:l}))})},this.pc.onsignalingstatechange=u=>{console.log("signaling state: "+this.pc.signalingState),this._state=String(this.pc.signalingState)}}async createOffer(){console.log("create offer");const e=await this.pc.createOffer();return await this.pc.setLocalDescription(e),e}async createInitialOffer(){return this._localCandidates=[],this.attachDataChannel(),await this.createOffer()}_generateUUID(){var e=new Date().getTime(),t=typeof performance!="undefined"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){var a=Math.random()*16;return e>0?(a=(e+a)%16|0,e=Math.floor(e/16)):(a=(t+a)%16|0,t=Math.floor(t/16)),(o==="x"?a:a&3|8).toString(16)})}_createWebsocket(e,t=0){return new Promise(async function(o,a){e||(e=this._generateUUID()),this._websocket=new WebSocket(this.websocket_configuration.address+e),this._websocket.onopen=()=>{o(e)},this._websocket.onmessage=async s=>{s.data.startsWith("/get")?(this._signalingFromWebsocket=!0,this.createInitialOffer()):(this._signalingFromWebsocket=!0,this.createAnswerFromString(s.data))},this._websocket.onclose=s=>{console.log("websocket closed")},this._websocket.onerror=s=>{this._websocket=null,o(null)}}.bind(this))}async websocketGenerateLink(){return await this._createWebsocket()}async websocketConsumeLink(e){return await this._createWebsocket(e)}async close(){this.pc.close(),this._websocket&&this._websocket.close(1e3,"close")}async createAnswerFromString(e){const t=xe.decompressFromEncodedURIComponent(e);t&&(e=t),await this.createAnswer(JSON.parse(e))}async createAnswer(e){let t=null;if(e.sdp){const o=e.sdp;try{if(o.type=="offer")console.log("create answer"),await this.pc.setRemoteDescription(e.sdp),t=await this.pc.createAnswer(),await this.pc.setLocalDescription(t);else if(this.pc.signalingState=="have-local-offer"&&await this.pc.setRemoteDescription(e.sdp),this._videoChatSenders.video&&(console.log("video transport state: ",this._videoChatSenders.video),this._videoChatSenders.video.transport.state=="connected")){let a=this._videoChatSenders.video.getParameters();console.log(a),a.encodings[0].scaleResolutionDownBy=1,this._videoChatSenders.video.setParameters(a),console.log("videochatsenders params",this._videoChatSenders.video.getParameters()),console.log("videochatsenders track settings",this._videoChatSenders.video.track.getSettings())}if(e.candidate){await this.pc.setRemoteDescription(e.sdp),console.log("adding candidate"),this._remoteCandidates=e.candidate;for(const a of e.candidate)await this.pc.addIceCandidate(a)}return t}catch(a){return console.log("----------------------",a),null}}return t}attachVideoChatStream(e=this._mediaSourcesHandler.currentStream){console.log("attach video chat stream",e.getTracks());const t=e.getTracks();console.log(this._mediaSourcesHandler),Object.entries(this._videoChatSenders).forEach(([o,a])=>{var u;const s=t.find(l=>l.kind==o);console.log(s),s&&s!=null?(s==null?void 0:s.label)!=((u=a.track)==null?void 0:u.label)&&(a.replaceTrack(s),console.log("replace"+s.label)):(this.pc.removeTrack(a),delete this._videoChatSenders[o])}),t.forEach(o=>{this._videoChatSenders[o.kind]||(this._videoChatSenders[o.kind]=this.pc.addTrack(o,e))}),console.log(this._videoChatSenders.video)}attachDataChannel(e="p2p",t=0){if(!(e in this._dataChannels)){console.log("attach datachannel:"+e);const o=this.pc.createDataChannel(e,{negotiated:e!="p2p",id:t});this._dataChannels[o.label]=o,e!=="p2p"?this._onDataChannel&&this._onDataChannel(this,this._dataChannels[o.label]):this.p2pDataChannelInitialization(this._dataChannels[o.label])}}p2pDataChannelInitialization(e){e.onopen=t=>{if(console.log("p2p is open!"),this._websocket&&this._websocket.close(1e3,"close"),this._connected=!0,this.attachDataChannel("chat",2),this._videoChatSendStream){this.attachVideoChatStream();let o=()=>{this.pc.signalingState!="stable"?setTimeout(()=>o(),100):this.createOffer().then(a=>{this._dataChannels.p2p.send(JSON.stringify({sdp:a}))})};o()}},e.onclose=()=>{console.log("channel close"),this._connected=!1},e.onmessage=async t=>{const o=JSON.parse(t.data),a=await this.createAnswer(o);a&&e.send(JSON.stringify({sdp:a}))}}get dataChannels(){return this._dataChannels}set videochatSendStream(e){this._videoChatSendStream=e}get videochatSendStream(){return this._videoChatSendStream}get remoteStreams(){return this._receiveStreams}get connected(){return this._connected}get state(){return this._state}}const Ct={class:"flex w-full h-screen bg-black"},Vt={class:"flex-1 p-inputgroup py-2"},Tt={class:"flex-1 p-inputgroup py-2"},Dt={class:"flex-1 p-inputgroup py-2"},It={class:"flex-1 p-inputgroup py-2"},Rt={class:"flex-1 p-inputgroup py-2"},Mt={class:"flex-1"},At={class:"flex-1 h-screen flex relative bg-black"},Lt={key:0,class:"absolute flex justify-center items-center flex-1 h-screen w-screen text-white text-center"},Ot=n("div",{class:"w-80"},[Se(" Some browsers require you to interact with the webpage before reproduce video. "),n("br"),n("br"),Se(" Please click or tap anywhere on this screen to reproduce remote video. ")],-1),Et=[Ot],zt={class:"absolute flex m-auto h-screen w-full items-center justify-center"},Ut={class:"flex flex-1 min-w-[350px] flex-col"},Bt={class:"field-checkbox m-9"},Ft=n("label",{for:"video-fullsize",class:"mx-3"},"Fill the screen size",-1),Wt={class:"flex flex-1 items-center justify-start ml-5"},$t={class:"flex flex-1 items-center justify-center"},jt=n("div",{class:"flex flex-1 items-center justify-center"},null,-1),Jt=oe({__name:"videochat",setup(m){let e,t;const o=Ge(),a=Ke(),s=Qe(),u=he([at(),ot()]),l=he(it());lt({title:"VideoChat",description:"One click videochat",image:"",type:"WebSite",location:s.path});const p=r(null),b=r(null),w=r(null),T=r(!1);let P;const q=r(!0),ie=r([]),J=r(0),E=r(!1),k=r(!1),y=r(!1),G=r(!1),K=r(!1),se=r(!1),C=r(""),z=he({video:[],audio:[]}),Q=r(!0),ne=r(!1),A=r(),I=r(),L=r(!0),R=r(!0),U=r(!1),le=r(!1),_=r(!1),V=r(!1),re=r(""),ce=r("");let O=r(),B=r({style:"",x:0,y:0});const{copy:Ve}=st(),Te=()=>{k.value?k.value=!1:(J.value=0,y.value==!0?(y.value=!1,setTimeout(()=>k.value=!0,100)):k.value=!0)},De=()=>{y.value?y.value=!1:k.value==!0?(k.value=!1,setTimeout(()=>y.value=!0,100)):y.value=!0},Ie=async()=>{V.value=!0,R.value?(!E.value&&await e.stopAndRemoveVideo(),R.value=!1):I.value&&(!E.value&&await e.startVideo(I.value),R.value=!0),t&&t.attachVideoChatStream(),V.value=!1},Re=async()=>{V.value=!0,L.value?(await e.stopAndRemoveAudio(),L.value=!1):A.value&&(await e.startAudio(A.value),L.value=!0,t&&t.attachVideoChatStream()),t&&t.attachVideoChatStream(),V.value=!1},Me=()=>{O.value=nt(b,{initialValue:{x:window.innerWidth-b.value.offsetWidth,y:window.innerHeight-b.value.offsetWidth}})},Ae=r([{label:"Exit",icon:"pi pi-angle-left text-vanilla-yellow ",command:()=>{ve(),a.push("/")}},{label:"Serverless",icon:"pi pi-server",command:()=>{G.value=!0}},{label:"Maximize",icon:"pi pi-window-maximize",command:()=>{_.value&&w.value?w.value.requestFullscreen():p.value.requestFullscreen()}},{label:"Settings",icon:"pi pi-cog",class:"p-button-raised",command:()=>{De()}}]);function F(c){ie.value.push(c)}function Le(c){t&&t.dataChannels.chat&&t.dataChannels.chat.send(c[c.length-1].data)}async function Oe(){if(!C.value&&!se.value){if(se.value=!0,console.log(C.value),a.push({path:"/videochat"}),t=new te(e,X,Y,F,Z),!await t.websocketGenerateLink()){o.add({severity:"error",summary:"Error",detail:"Error generating link. Contact the signaling server system administrator.",group:"br",life:3e3});return}let i=await t.websocketGenerateLink();C.value=document.location.href+"?room="+i,a.push({path:"/videochat",query:{room:i}}),se.value=!1}K.value=!0}function Ee(){Ve(C.value),K.value=!1}function X(c,i,f){w.value&&(P=f[0],w.value.srcObject=P,w.value.oncanplay=v=>{w.value.play().catch(()=>{T.value=!0})}),i.kind=="video"&&setTimeout(()=>me(),3e3)}function Y(c,i){i.onopen=async function(f){console.log(this.label+" is open!"),G.value=!1,i.send("hello"),_.value=!0,setTimeout(()=>!O.value&&Me(),0)},i.onclose=()=>{console.log("channel close"),w.value.srcObject=null,_.value=!1,fe(),pe()},i.onmessage=f=>{console.log(f.data),F({data:f.data,own:!1}),k.value||J.value++}}function ve(){C.value="",a.push({path:"/videochat"}),fe()}function fe(){t&&t.close()}function Z(c){ce.value=c}async function ze(){t=new te(e,X,Y,F,Z),await t.createInitialOffer()}async function Ue(){(!t||t.state!="have-local-offer")&&(t=new te(e,X,Y,F,Z)),await t.createAnswerFromString(re.value)}async function Be(){Q.value=!1,await de(),z.audio=e.audioDevices,z.video=e.videoDevices,Q.value=!0}async function de(){{if(e=new yt(p),!await e.initializeLocalStream())return R.value=!1,L.value=!1,o.add({severity:"error",summary:"Error",detail:"Error while trying to get the camera. Check the permissions for the camera.",group:"br",life:3e3}),ne.value=!0,null;ne.value=!1,await e.getMediaDevices(),e.currentAudioTracks.length>0&&(L.value=!0),e.currentVideoTracks.length>0&&(R.value=!0),z.audio=e.audioDevices,z.video=e.videoDevices,A.value=e.currentDevices.audio,I.value=e.currentDevices.video}}async function Fe(){if(Q.value=!1,E.value)await e.stopAndRemoveVideo(),R.value&&await e.startVideo(I.value),t&&t.attachVideoChatStream(),q.value=!0,E.value=!1;else{if(!await e.getScreenStream())return;t&&t.attachVideoChatStream(),q.value=!1,E.value=!0}Q.value=!0}function me(){if(t){const c=l.width/l.height;for(const i in t.remoteStreams)t.remoteStreams[i].getVideoTracks().forEach(f=>{const v=f.getSettings();c<.7&&v.width/v.height>.9?f.applyConstraints({aspectRatio:{ideal:.9}}):f.applyConstraints({aspectRatio:{ideal:null}})})}}async function pe(){C.value&&(t=new te(e,X,Y,F,Z),await t.websocketConsumeLink(s.query.room)||o.add({severity:"error",summary:"Error",detail:"Error while trying to connnect to the signaling server",group:"br",life:3e3}))}const ge=c=>async(i,f)=>{{if(c==="audio"&&!L.value||c==="video"&&!R.value)return null;f&&(V.value=!0,await e.changeSourceStream(A.value,I.value),V.value=!1,t&&t.attachVideoChatStream()),c=="video"&&e.currentVideoCapabilities&&(q.value=!JSON.stringify(e.currentVideoCapabilities.facingMode).includes("environment"))}};M(A,ge("audio")),M(I,ge("video")),M(_,async c=>{c===!0?setTimeout(()=>{U.value=!0},5e3):U.value=!1});let ue=null;M(u,()=>{_.value===!0?(U.value=!1,clearTimeout(ue),ue=setTimeout(()=>{U.value=!0},5e3)):(U.value=!1,clearTimeout(ue))}),M(u[1],()=>{T.value===!0&&w.value.play().then(()=>{T.value=!1})});function be(c=B.value.x,i=B.value.y){const f=l.width-b.value.offsetWidth,v=l.height-b.value.offsetHeight,W=0,$=0;c>f&&(c=f),i>v&&(i=v),c<W&&(c=W),i<$&&(i=$),c<=f&&i<=v&&c>=0&&i>=0&&(B.value={style:"transform: translate3d("+c+"px, "+i+"px, 0px);",x:c,y:i})}return M(O,()=>{be(O.value.x,O.value.y)},{deep:!0}),M(l,()=>{B.value.x+b.value.offsetWidth>=l.width&&be(l.width-b.value.offsetWidth),me()},{deep:!0}),Xe(()=>{(async()=>(await de(),s.query.room&&s.query.room.length>0&&(C.value=document.location.href,pe())))()}),Ye(()=>{e.stopLocalStream()}),(c,i)=>{const f=S("InputText"),v=S("Button"),W=S("Textarea"),$=S("Dialog"),We=S("SpeedDial"),$e=S("Toast"),_e=ut,je=S("Checkbox"),we=_t,Ne=kt,He=et("badge");return g(),D("div",Ct,[d($,{header:"Serverless connection",footer:"",visible:G.value,"onUpdate:visible":i[2]||(i[2]=h=>G.value=h),class:"flex"},{default:j(()=>[n("div",Vt,[d(f,{placeholder:"Introduce offer/answer",modelValue:re.value,"onUpdate:modelValue":i[0]||(i[0]=h=>re.value=h)},null,8,["modelValue"]),d(v,{label:"Go",onClick:Ue})]),n("div",Tt,[d(v,{label:"Create offer",class:"w-full",onClick:ze})]),n("div",Dt,[d(W,{modelValue:ce.value,"onUpdate:modelValue":i[1]||(i[1]=h=>ce.value=h),disabled:"",rows:"5",class:"min-w-[17rem] w-full"},null,8,["modelValue"])])]),_:1},8,["visible"]),d($,{header:"Share link",footer:"",visible:K.value,"onUpdate:visible":i[4]||(i[4]=h=>K.value=h),class:"flex w-50rem"},{default:j(()=>[n("div",It,[d(W,{modelValue:C.value,"onUpdate:modelValue":i[3]||(i[3]=h=>C.value=h),disabled:"",rows:"2",class:"w-[50rem] w-full"},null,8,["modelValue"])]),n("div",Rt,[d(v,{label:"Copy to clipboard",class:"w-full",onClick:Ee})])]),_:1},8,["visible"]),n("div",{ref:"superiorToolBar",class:x(["absolute flex flex-row w-full text-right transition-all duration-400 disable-rounded",{"lg:pr-[400px]":y.value}])},[d(We,{radius:140,model:Ae.value,showIcon:"pi pi-bars text-vanilla-yellow",tooltipOptions:{event:null,position:"right"},hideIcon:"pi pi-times text-vanilla-yellow",direction:"down-right",type:"quarter-circle",buttonClass:"p-button-text",class:"up left transform !-translate-x-5 !-translate-y-5 disable-rounded !z-50"},null,8,["model"]),n("div",Mt,[_.value?(g(),ee(v,{key:0,icon:"pi pi-comments p-text-secondary",class:"p-button-rounded p-button-text !p-12 up right transform !translate-x-6 !-translate-y-8",onClick:Te},{default:j(()=>[tt(n("i",{class:x(["pi pi-comments mr-2 p-text-secondary text-vanilla-yellow",{"hide-badge":J.value==0}]),style:{"font-size":"2rem"}},null,2),[[He,J.value]])]),_:1})):N("",!0)])],2),n("div",At,[T.value?(g(),D("div",Lt,Et)):N("",!0),n("video",{autoplay:"",ref_key:"videoRemote",ref:w,class:x(["flex-1 max-h-screen w-full",{"!object-cover":le.value}])},null,2),n("div",{ref_key:"videoLocalContainer",ref:b,class:x(["absolute flex m-auto h-screen w-full items-center z-30",{"w-[unset]":_.value,"h-1/4":_.value,"transition-all duration-600":H(O)&&!H(O).isDragging}]),style:Ze([{"touch-action":"none"},_.value?H(B)&&H(B).style:""])},[n("video",{autoplay:"",ref_key:"videoLocal",ref:p,class:x(["flex-1 w-full max-h-screen max-h-full max-w-full <lg:object-cover",{"transform  rotate-y-180":q.value}])},null,2)],6),n("div",zt,[ne.value&&!_.value?(g(),ee(v,{key:0,icon:"pi pi-camera",label:"Get media devices",class:"p-button-danger m-auto flex-grow-0",onClick:de})):N("",!0)]),d($e,{position:"bottom-left",group:"br"})]),d(we,{open:y.value,"onUpdate:open":i[8]||(i[8]=h=>y.value=h),class:"w-[400px] disable-rounded",title:"Settings"},{default:j(()=>[n("div",Ut,[d(_e,{modelValue:I.value,"onUpdate:modelValue":i[5]||(i[5]=h=>I.value=h),items:z.video,title:"Video devices",disabled:V.value},null,8,["modelValue","items","disabled"]),d(_e,{modelValue:A.value,"onUpdate:modelValue":i[6]||(i[6]=h=>A.value=h),items:z.audio,title:"Audio devices",disabled:V.value},null,8,["modelValue","items","disabled"]),n("div",Bt,[d(je,{id:"video-fullsize",modelValue:le.value,"onUpdate:modelValue":i[7]||(i[7]=h=>le.value=h),binary:!0},null,8,["modelValue"]),Ft]),d(v,{icon:"pi pi-camera",label:"Refresh media devices",class:"p-button-danger m-auto flex-grow-0 !absolute bottom-0 right-0 left-0 min-w-[350px] w-full",onClick:Be})])]),_:1},8,["open"]),d(we,{open:k.value,"onUpdate:open":i[10]||(i[10]=h=>k.value=h),title:"Chat",class:"w-[470px] disable-rounded"},{default:j(()=>[d(Ne,{modelValue:ie.value,"onUpdate:modelValue":[i[9]||(i[9]=h=>ie.value=h),Le]},null,8,["modelValue"])]),_:1},8,["open"]),n("div",{ref:"lowerToolBar",class:x(["absolute bottom-10 <sxl:bottom-3 flex flex-row w-full text-center transition-all duration-400 bottom-0 align-center items-center lower-toolbar",{"lg:pr-[400px]":y.value||k.value,hidden:U.value}])},[n("div",Wt,[_.value?N("",!0):(g(),ee(v,{key:0,icon:`pi pi-user-plus ${C.value?"pi-spin pi-spinner":""} `,onClick:Oe,class:"p-button-rounded p-button-warning lower-toolbar-button"},null,8,["icon"]))]),n("div",$t,[d(v,{icon:"pi pi-desktop",class:x(["p-button-rounded lower-toolbar-button",{"button-disabled":!E.value}]),onClick:Fe},null,8,["class"]),d(v,{disabled:V.value,icon:"pi pi-bell",class:x(["p-button-rounded lower-toolbar-button",{"button-disabled":!L.value}]),onClick:Re},null,8,["disabled","class"]),d(v,{disabled:V.value,icon:"pi pi-video",class:x(["p-button-rounded lower-toolbar-button",{"button-disabled":!R.value}]),onClick:Ie},null,8,["disabled","class"]),_.value?(g(),ee(v,{key:0,icon:"pi pi-phone",onClick:ve,class:"p-button-rounded p-button-danger lower-toolbar-button transform rotate-z-134"})):N("",!0)]),jt],2)])}}});export{Jt as default};
